<!-- Bouton flottant -->
<button
  class="chat-toggle"
  type="button"
  aria-label="Ouvrir le chat"
  [attr.aria-expanded]="isOpen"
  aria-controls="chatbot-panel"
  (click)="toggleChat()">
  <!-- IcÃ´ne bulle simple en SVG -->
  <svg width="22" height="22" viewBox="0 0 24 24" aria-hidden="true">
    <path fill="currentColor" d="M20 2H4a2 2 0 0 0-2 2v15.5a.5.5 0 0 0 .79.41L7 17h13a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2Z"/>
  </svg>
</button>

<!-- Panneau du chat -->
<section
  id="chatbot-panel"
  class="chat-panel"
  aria-label="Panneau de discussion"
  *ngIf="isOpen">

  <header class="chat-header">
    <div class="chat-title">
      <span class="dot"></span>
      <span>Assistant</span>
    </div>
    <div class="chat-actions">
      <button class="icon-btn" type="button" (click)="clearConversation()" title="Effacer la conversation" aria-label="Effacer la conversation">
        <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true">
          <path fill="currentColor" d="M6 7h12l-1 14H7L6 7Zm3-3h6l1 2H8l1-2Z"/>
        </svg>
      </button>
      <button class="icon-btn" type="button" (click)="closeChat()" title="Fermer" aria-label="Fermer">
        <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true">
          <path fill="currentColor" d="M18 6L6 18M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </button>
    </div>
  </header>

  <div class="chat-body">
    <div class="messages" role="log" aria-live="polite">
      <div *ngFor="let msg of messages; " class="message" [class.user]="msg.role === 'user'" [class.bot]="msg.role === 'bot'">
        <div class="bubble">
          {{ msg.text }}
        </div>
        <time class="time" [attr.datetime]="msg.time.toISOString()">{{ msg.time | date:'shortTime' }}</time>
      </div>
      <div class="empty" *ngIf="messages.length === 0">
        Ask your questions here!
      </div>
    </div>
  </div>

  <footer class="chat-input">
    <textarea
      #msgInput
      class="input"
      rows="1"
      placeholder="Write a message..."
      [value]="draft"
      (input)="draft = msgInput.value"
      (keydown)="handleKeydown($event)">
    </textarea>
    <button type="button" class="send-btn" (click)="sendMessage()" [disabled]="!draft.trim()" aria-label="Envoyer">
      <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true">
        <path fill="currentColor" d="M2 21l21-9L2 3v7l15 2-15 2z"/>
      </svg>
    </button>
  </footer>
</section>
