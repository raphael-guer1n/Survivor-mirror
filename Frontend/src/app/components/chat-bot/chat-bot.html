<button
        class="com-toggle"
        type="button"
        aria-label="Open communication"
        [attr.aria-expanded]="isOpen"
        aria-controls="communication-panel"
        (click)="toggleChat()"
        (click)="toggleChat_access()">
    <svg width="22" height="22" viewBox="0 0 24 24" aria-hidden="true">
        <path fill="currentColor"
              d="M20 2H4a2 2 0 0 0-2 2v15.5a.5.5 0 0 0 .79.41L7 17h13a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2Z"/>
    </svg>
</button>

<div *ngIf="isOpen && !logged">
    <section
            id="communication-panel"
            class="com-panel"
            aria-label="Chat pannel">

        <header class="com-header">
            <div class="com-title">
                <span class="dot"></span>
                <span>Communication</span>
            </div>
            <div class="com-actions">
                <button class="icon-btn" type="button" (click)="closeChat()" title="Close" aria-label="Close">
                    <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true">
                        <path fill="currentColor" d="M18 6L6 18M6 6l12 12" stroke="currentColor" stroke-width="2"
                              stroke-linecap="round"/>
                    </svg>
                </button>
            </div>
        </header>
        <textarea
        #msgInput
        class="reciver_name"
        rows="1"
        placeholder="Send a message to:..."
        [value]="reciver_name"
        (input)="reciver_name = msgInput.value"
        (keydown)="handleKeydown($event)">
      </textarea>
        <div class="com-body">
            <div class="messages" role="log" aria-live="polite">
                <div *ngFor="let msg of messages; " class="message" [class.sender]="msg.role === 'sender'"
                     [class.reciver]="msg.role === 'reciver'">
                    <div class="bubble">
                        {{ msg.text }}
                    </div>
                    <time class="time" [attr.datetime]="msg.time.toISOString()">{{ msg.time | date:'shortTime' }}</time>
                </div>
                <div class="empty" *ngIf="messages.length === 0">
                    Please login or register.
                </div>
            </div>
        </div>

    <footer class="com-input">
        <textarea
          #msgInput
          class="input"
          rows="1"
          placeholder="Write a message..."
          [value]="draft"
          (input)="draft = msgInput.value"
          (keydown)="handleKeydown($event)">
        </textarea>
                <button type="button" class="send-btn" (click)="sendMessage()" [disabled]="!draft.trim()"
                        aria-label="Envoyer">
                    <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true">
                        <path fill="currentColor" d="M2 21l21-9L2 3v7l15 2-15 2z"/>
                    </svg>
                </button>
            </footer>
    </section>
</div>

<div *ngIf="isOpen && logged">
    <section
            id="communication-panel"
            class="com-panel"
            aria-label="Chat pannel">

        <header class="com-header">
            <div class="com-title">
                <span class="dot"></span>
                <span>Communication</span>
            </div>
            <div class="com-actions">
                <button class="icon-btn" type="button" (click)="clearConversation()" title="Clear conversation"
                        aria-label="Clear conversation">
                    <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true">
                        <path fill="currentColor" d="M6 7h12l-1 14H7L6 7Zm3-3h6l1 2H8l1-2Z"/>
                    </svg>
                </button>
                <button class="icon-btn" type="button" (click)="closeChat()" title="Close" aria-label="Close">
                    <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true">
                        <path fill="currentColor" d="M18 6L6 18M6 6l12 12" stroke="currentColor" stroke-width="2"
                              stroke-linecap="round"/>
                    </svg>
                </button>
            </div>
        </header>
        <footer class="com-input">
            <textarea
              #msgInput
              class="input"
              rows="1"
              placeholder="Send a message to:..."
              [(ngModel)]="reciver_name"
              (keydown)="handleKeydown($event)">
            </textarea>
            <button type="button" class="send-btn" (click)="load_conversation()" [disabled]="!draft.trim()"
                    aria-label="Rechercher">
                <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true">
                    <path fill="currentColor" d="M2 21l21-9L2 3v7l15 2-15 2z"/>
                </svg>
            </button>
        </footer>
        <div class="com-body">
            <div class="messages" role="log" aria-live="polite">
                <div *ngFor="let msg of messages; " class="message" [class.sender]="msg.role === 'sender'"
                     [class.reciver]="msg.role === 'reciver'">
                    <div class="bubble">
                        {{ msg.text }}
                    </div>
                    <time class="time" [attr.datetime]="msg.time.toISOString()">{{ msg.time | date:'shortTime' }}</time>
                </div>
                <div class="empty" *ngIf="messages.length === 0">
                    Display conversation here.
                </div>
            </div>
        </div>

        <footer class="com-input">
    <textarea
      #msgInput
      class="input"
      rows="1"
      placeholder="Write a message..."
      [(ngModel)]="draft"
      (keydown)="handleKeydown($event)">
    </textarea>
            <button type="button" class="send-btn" (click)="sendMessage()" [disabled]="!draft.trim()"
                    aria-label="Envoyer">
                <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true">
                    <path fill="currentColor" d="M2 21l21-9L2 3v7l15 2-15 2z"/>
                </svg>
            </button>
        </footer>
    </section>
</div>
