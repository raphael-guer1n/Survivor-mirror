@if (user$ | async; as user) {
  <h1>My account</h1>

  @if (!editing) {
    <div class="card">
      <p><strong>Name:</strong> {{ user.name }}</p>
      <p><strong>Email:</strong> {{ user.email }}</p>
      <p><strong>Role:</strong> {{ user.role || '—' }}</p>
    </div>
    <div class="actions">
      <button class="btn" (click)="startEdit(user)">Edit profile</button>
      <button class="btn" (click)="logout()">Logout</button>
    </div>
  } @else {
    <form [formGroup]="form" (ngSubmit)="save()" class="card">
      <div class="field">
        <label for="name">Name</label>
        <input id="name" type="text" formControlName="name" />
        @if (form.controls.name.touched && form.controls.name.invalid) {
          <small class="error">Name is required (min 2 chars)</small>
        }
      </div>

      <div class="field">
        <label for="email">Email</label>
        <input id="email" type="email" formControlName="email" />
        @if (form.controls.email.touched && form.controls.email.invalid) {
          <small class="error">Please enter a valid email</small>
        }
      </div>

      @if (error) {
        <p class="error">{{ error }}</p>
      }

      <div class="actions">
        <button class="btn" type="submit" [disabled]="saving">
          {{ saving ? 'Saving…' : 'Save changes' }}
        </button>
        <button class="btn secondary" type="button" (click)="cancelEdit()" [disabled]="saving">Cancel</button>
        <button class="btn secondary" type="button" (click)="logout()">Logout</button>
      </div>
    </form>
  }
} @else {
  <ng-template>
    <p>Loading your profile…</p>
  </ng-template>
}