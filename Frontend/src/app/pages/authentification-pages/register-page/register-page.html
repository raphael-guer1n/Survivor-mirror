<section class="auth-container">
    <h1>Create a account</h1>

    <form (ngSubmit)="onSubmit()" #registerForm="ngForm" novalidate>
        <div class="field">
            <label for="email">Email</label>
            <input
                    id="email"
                    name="email"
                    type="email"
                    [(ngModel)]="email"
                    required
                    [readonly]="phase === 'verify'"
                    autocomplete="username"
                    placeholder="mail@exemple.com"
            />
        </div>

        <div class="field">
            <label for="password">Password</label>
            <input
                    id="password"
                    name="password"
                    type="password"
                    [(ngModel)]="password"
                    required
                    [readonly]="phase === 'verify'"
                    autocomplete="new-password"
                    placeholder="Password"
            />
        </div>

        <div class="field">
            <label for="confirm">Confirm password</label>
            <input
                    id="confirm"
                    name="confirm"
                    type="password"
                    [(ngModel)]="confirm"
                    required
                    [readonly]="phase === 'verify'"
                    autocomplete="new-password"
                    placeholder="Confirm password"
            />
            @if (confirm && !passwordsMatch && phase === 'request') {
                <small class="error">
                    Passwords do not match
                </small>
            }
        </div>

        @if (phase === 'verify') {
            <div class="field">
                <label for="code">Verification code</label>
                <input
                        id="code"
                        name="code"
                        type="text"
                        [(ngModel)]="code"
                        required
                        placeholder="Enter the code received by email"
                        autocomplete="one-time-code"
                />
            </div>
        }

        <button
                class="btn"
                type="submit"
                [disabled]="loading ||
                        !registerForm.form.valid ||
                        (phase === 'request' && !passwordsMatch) ||
                        (phase === 'verify' && !code)">
            {{
            loading
              ? (phase === 'request' ? 'Sending code...' : 'Creating account...')
              : (phase === 'request' ? 'Send verification code' : 'Verify code and create account')
            }}
        </button>

        @if (error) {
            <p class="error">{{ error }}</p>
        }
        @if (info) {
            <p class="hint">{{ info }}</p>
        }
    </form>

    <p class="hint">
        Already have an account?
        <a routerLink="/login">Connect</a>
    </p>
</section>