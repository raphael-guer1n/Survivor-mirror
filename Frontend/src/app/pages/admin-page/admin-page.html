<section class="admin-page content">
    <header class="admin-header">
        <h1>Administration</h1>
        <div class="entity-tabs">
            @for (e of entities; track e) {
                <button
                        type="button"
                        class="tab"
                        [class.active]="e === selectedEntity()"
                        (click)="onEntityChange(e)"
                >
                    {{ e | titlecase }}
                </button>
            }
        </div>
    </header>

    @if (errorMsg()) {
        <div class="alert error">{{ errorMsg() }}</div>
    }
    @if (loading()) {
        <div class="loading">Chargement…</div>
    }

    @if (selectedEntity() === 'startups') {
        <div class="toolbar card">
            <input
                    type="search"
                    [(ngModel)]="query"
                    placeholder="Search"
                    aria-label="Search"
                    class="search"
            />

            @for (f of startupFilters; track f[0]) {
                <select [(ngModel)]="filterValues[f[0]]" aria-label="Filter by {{ f[0] }}" class="select">
                    <option value="">{{ f[0] | titlecase }}</option>
                    @for (v of f.slice(1); track v) {
                        <option [value]="v">{{ v }}</option>
                    }
                </select>
            }
        </div>

        <div class="grid">
            @for (s of filteredStartups; track trackById) {
                <article class="card card-clickable" (click)="openStartup(s.id)" title="Éditer/Supprimer">
                    <header class="card-header">
                        <h3 class="card-title">{{ s.name }}</h3>
                        @if (s.maturity) {
                            <span class="badge">{{ s.maturity }}</span>
                        }
                    </header>

                    <div class="card-body">
                        <div class="row">
                            <span class="label">Mail:</span>
                            @if (s.email) {
                                <a [href]="'mailto:' + s.email" (click)="$event.stopPropagation()">{{ s.email }}</a>
                            } @else {
                                <span class="muted">-</span>
                            }
                        </div>
                        <div class="row">
                            <span class="label">Sector:</span>
                            <span>{{ s.sector || '—' }}</span>
                        </div>
                        <div class="row">
                            <span class="label">Legal Status:</span>
                            <span>{{ s.legal_status || '—' }}</span>
                        </div>
                        <div class="row">
                            <span class="label">Phone:</span>
                            <span>{{ s.phone || '—' }}</span>
                        </div>
                        <div class="row">
                            <span class="label">Address:</span>
                            <span>{{ s.address || '—' }}</span>
                        </div>
                    </div>
                </article>
            }
        </div>

        @if (filteredStartups.length === 0 && !loading()) {
            <div class="empty">Aucun résultat pour "{{ query }}".</div>
        }

        @if (selectedStartupId() !== null) {
            <app-admin-startup-edit-popup
                    [startupId]="selectedStartupId()!"
                    (closed)="closeStartup()"
            ></app-admin-startup-edit-popup>
        }
    }

</section>